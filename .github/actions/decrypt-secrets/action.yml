name: 'Inflate Secrets'
description: 'Inflates the secret values into the appropriate files'
inputs:
  android_module_path:
    description: 'Path to Android module'
    required: true
  keystore:
    description: 'The keystore to inflate'
    required: true
  google-services:
    description: 'The google-services.json to inflate'
    required: true
  playstore-creds:
    description: 'The playstore credentials to inflate'
    required: true
  firebase-creds:
    description: 'The firebase credentials to inflate'
    required: true
runs:
  using: 'composite'
  steps:
    - name: Mock debug google-services.json
      shell: bash
      run: |
        cp .github/mock-google-services.json ${{ inputs.android_module_path }}/google-services.json

    - name: Inflate release_keystore.keystore
      shell: bash
      env:
        KEYSTORE: ${{ inputs.keystore }}
      run: |
        echo $KEYSTORE | base64 --decode > ${{ inputs.android_module_path }}/release_keystore.keystore

    - name: Inflate google-services.json
      shell: bash
      env:
        GOOGLE_SERVICES: ${{ inputs.google-services }}
      run: |
        echo $GOOGLE_SERVICES > ${{ inputs.android_module_path }}/google-services.json

    - name: Inflate playStorePublishServiceCredentialsFile.json
      shell: bash
      env:
        CREDS: ${{ inputs.playstore-creds }}
      run: |
        # Create the file with appropriate permissions
        touch ${{ inputs.android_module_path }}/playStorePublishServiceCredentialsFile.json
        echo $CREDS > ${{ inputs.android_module_path }}/playStorePublishServiceCredentialsFile.json

    - name: Inflate firebaseAppDistributionServiceCredentialsFile.json
      shell: bash
      env:
        FIREBASE_CREDS: ${{ inputs.firebase-creds }}
      run: |
        echo $FIREBASE_CREDS > ${{ inputs.android_module_path }}/firebaseAppDistributionServiceCredentialsFile.json